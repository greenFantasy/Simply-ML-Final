{"ast":null,"code":"import { codegen, constants, functions } from 'vega-expression';\nimport { isTuple } from 'vega-dataflow';\nimport { selectionTest, selectionResolve, selectionVisitor } from 'vega-selections';\nimport { random, cumulativeNormal, cumulativeLogNormal, cumulativeUniform, densityNormal, densityLogNormal, densityUniform, quantileNormal, quantileLogNormal, quantileUniform, sampleNormal, sampleLogNormal, sampleUniform } from 'vega-statistics';\nimport { isArray, isBoolean, isDate, isNumber, isObject, isRegExp, isString, panLinear, panLog, panPow, panSymlog, zoomLinear, zoomLog, zoomPow, zoomSymlog, toBoolean, toDate, toNumber, toString, clampRange, extent, flush, inrange, lerp, pad, peek, quarter, utcquarter, span, stringValue, truncate } from 'vega-util';\nimport { range as sequence } from 'd3-array';\nimport { rgb, lab, hcl, hsl } from 'd3-color';\nimport { luminance, contrast } from './luminance';\nimport { data, indata, setdata } from './data';\nimport { default as encode } from './encode';\nimport { format, utcFormat, timeFormat, utcParse, timeParse, monthFormat, monthAbbrevFormat, dayFormat, dayAbbrevFormat } from './format';\nimport { geoArea, geoBounds, geoCentroid } from './geo';\nimport { default as inScope } from './inscope';\nimport { default as intersect } from './intersect';\nimport { warn, info, debug } from './log';\nimport { default as merge } from './merge';\nimport { default as modify } from './modify';\nimport { pinchDistance, pinchAngle } from './pinch';\nimport { range, domain, bandwidth, bandspace, copy, scale, invert } from './scale';\nimport { default as scaleGradient } from './scale-gradient';\nimport { geoShape, pathShape } from './shape';\nimport { treePath, treeAncestors } from './tree';\nimport { containerSize, screen, windowSize } from './window';\nimport { dataVisitor, indataVisitor, scaleVisitor } from './visitors';\nimport { SignalPrefix } from './prefix'; // Expression function context object\n\nexport const functionContext = {\n  random: function () {\n    return random();\n  },\n  // override default\n  cumulativeNormal,\n  cumulativeLogNormal,\n  cumulativeUniform,\n  densityNormal,\n  densityLogNormal,\n  densityUniform,\n  quantileNormal,\n  quantileLogNormal,\n  quantileUniform,\n  sampleNormal,\n  sampleLogNormal,\n  sampleUniform,\n  isArray,\n  isBoolean,\n  isDate,\n  isDefined: function (_) {\n    return _ !== undefined;\n  },\n  isNumber,\n  isObject,\n  isRegExp,\n  isString,\n  isTuple,\n  isValid: function (_) {\n    return _ != null && _ === _;\n  },\n  toBoolean,\n  toDate,\n  toNumber,\n  toString,\n  flush,\n  lerp,\n  merge,\n  pad,\n  peek,\n  span,\n  inrange,\n  truncate,\n  rgb,\n  lab,\n  hcl,\n  hsl,\n  luminance,\n  contrast,\n  sequence,\n  format,\n  utcFormat,\n  utcParse,\n  timeFormat,\n  timeParse,\n  monthFormat,\n  monthAbbrevFormat,\n  dayFormat,\n  dayAbbrevFormat,\n  quarter,\n  utcquarter,\n  warn,\n  info,\n  debug,\n  extent,\n  inScope,\n  intersect,\n  clampRange,\n  pinchDistance,\n  pinchAngle,\n  screen,\n  containerSize,\n  windowSize,\n  bandspace,\n  setdata,\n  pathShape,\n  panLinear,\n  panLog,\n  panPow,\n  panSymlog,\n  zoomLinear,\n  zoomLog,\n  zoomPow,\n  zoomSymlog,\n  encode,\n  modify\n};\nconst eventFunctions = ['view', 'item', 'group', 'xy', 'x', 'y'],\n      // event functions\neventPrefix = 'event.vega.',\n      // event function prefix\nthisPrefix = 'this.',\n      // function context prefix\nastVisitors = {}; // AST visitors for dependency analysis\n// Build expression function registry\n\nfunction buildFunctions(codegen) {\n  const fn = functions(codegen);\n  eventFunctions.forEach(name => fn[name] = eventPrefix + name);\n\n  for (let name in functionContext) {\n    fn[name] = thisPrefix + name;\n  }\n\n  return fn;\n} // Register an expression function\n\n\nexport function expressionFunction(name, fn, visitor) {\n  if (arguments.length === 1) {\n    return functionContext[name];\n  } // register with the functionContext\n\n\n  functionContext[name] = fn; // if there is an astVisitor register that, too\n\n  if (visitor) astVisitors[name] = visitor; // if the code generator has already been initialized,\n  // we need to also register the function with it\n\n  if (codeGenerator) codeGenerator.functions[name] = thisPrefix + name;\n  return this;\n} // register expression functions with ast visitors\n\nexpressionFunction('bandwidth', bandwidth, scaleVisitor);\nexpressionFunction('copy', copy, scaleVisitor);\nexpressionFunction('domain', domain, scaleVisitor);\nexpressionFunction('range', range, scaleVisitor);\nexpressionFunction('invert', invert, scaleVisitor);\nexpressionFunction('scale', scale, scaleVisitor);\nexpressionFunction('gradient', scaleGradient, scaleVisitor);\nexpressionFunction('geoArea', geoArea, scaleVisitor);\nexpressionFunction('geoBounds', geoBounds, scaleVisitor);\nexpressionFunction('geoCentroid', geoCentroid, scaleVisitor);\nexpressionFunction('geoShape', geoShape, scaleVisitor);\nexpressionFunction('indata', indata, indataVisitor);\nexpressionFunction('data', data, dataVisitor);\nexpressionFunction('treePath', treePath, dataVisitor);\nexpressionFunction('treeAncestors', treeAncestors, dataVisitor); // register Vega-Lite selection functions\n\nexpressionFunction('vlSelectionTest', selectionTest, selectionVisitor);\nexpressionFunction('vlSelectionResolve', selectionResolve, selectionVisitor); // Export code generator and parameters\n\nexport const codegenParams = {\n  blacklist: ['_'],\n  whitelist: ['datum', 'event', 'item'],\n  fieldvar: 'datum',\n  globalvar: function (id) {\n    return '_[' + stringValue(SignalPrefix + id) + ']';\n  },\n  functions: buildFunctions,\n  constants: constants,\n  visitors: astVisitors\n};\nexport var codeGenerator = codegen(codegenParams);","map":null,"metadata":{},"sourceType":"module"}