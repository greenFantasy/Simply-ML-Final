{"ast":null,"code":"import { stringValue } from 'vega-util';\nimport { TUPLE, unitName } from '.';\nimport { TUPLE_FIELDS } from './transforms/project';\nexport function singleOrMultiSignals(model, selCmpt) {\n  const name = selCmpt.name;\n  const fieldsSg = name + TUPLE_FIELDS;\n  const proj = selCmpt.project;\n  const datum = '(item().isVoronoi ? datum.datum : datum)';\n  const values = proj.items.map(p => {\n    const fieldDef = model.fieldDef(p.channel); // Binned fields should capture extents, for a range test against the raw field.\n\n    return fieldDef && fieldDef.bin ? \"[\".concat(datum, \"[\").concat(stringValue(model.vgField(p.channel, {})), \"], \") + \"\".concat(datum, \"[\").concat(stringValue(model.vgField(p.channel, {\n      binSuffix: 'end'\n    })), \"]]\") : \"\".concat(datum, \"[\").concat(stringValue(p.field), \"]\");\n  }).join(', '); // Only add a discrete selection to the store if a datum is present _and_\n  // the interaction isn't occurring on a group mark. This guards against\n  // polluting interactive state with invalid values in faceted displays\n  // as the group marks are also data-driven. We force the update to account\n  // for constant null states but varying toggles (e.g., shift-click in\n  // whitespace followed by a click in whitespace; the store should only\n  // be cleared on the second click).\n\n  const update = \"unit: \".concat(unitName(model), \", fields: \").concat(fieldsSg, \", values\");\n  const signals = [{\n    name: name + TUPLE,\n    on: selCmpt.events ? [{\n      events: selCmpt.events,\n      update: \"datum && item().mark.marktype !== 'group' ? {\".concat(update, \": [\").concat(values, \"]} : null\"),\n      force: true\n    }] : []\n  }];\n  return signals;\n}\nconst multi = {\n  signals: singleOrMultiSignals,\n  modifyExpr: (model, selCmpt) => {\n    const tpl = selCmpt.name + TUPLE;\n    return tpl + ', ' + (selCmpt.resolve === 'global' ? 'null' : \"{unit: \".concat(unitName(model), \"}\"));\n  }\n};\nexport default multi;","map":null,"metadata":{},"sourceType":"module"}