{"ast":null,"code":"import { selector as parseSelector } from 'vega-event-selector';\nimport { isString } from 'vega-util';\nimport { TUPLE } from '..';\nimport { varName } from '../../../util';\nimport inputBindings from './inputs';\nimport toggle, { TOGGLE } from './toggle';\nconst clear = {\n  has: selCmpt => {\n    return selCmpt.clear !== undefined && selCmpt.clear !== false;\n  },\n  parse: (model, selCmpt, selDef) => {\n    if (selDef.clear) {\n      selCmpt.clear = isString(selDef.clear) ? parseSelector(selDef.clear, 'scope') : selDef.clear;\n    }\n  },\n  topLevelSignals: (model, selCmpt, signals) => {\n    if (inputBindings.has(selCmpt)) {\n      selCmpt.project.items.forEach(proj => {\n        const idx = signals.findIndex(n => n.name === varName(\"\".concat(selCmpt.name, \"_\").concat(proj.field)));\n\n        if (idx !== -1) {\n          signals[idx].on.push({\n            events: selCmpt.clear,\n            update: 'null'\n          });\n        }\n      });\n    }\n\n    return signals;\n  },\n  signals: (model, selCmpt, signals) => {\n    function addClear(idx, update) {\n      if (idx !== -1 && signals[idx].on) {\n        signals[idx].on.push({\n          events: selCmpt.clear,\n          update\n        });\n      }\n    } // Be as minimalist as possible when adding clear triggers to minimize dataflow execution.\n\n\n    if (selCmpt.type === 'interval') {\n      selCmpt.project.items.forEach(proj => {\n        const vIdx = signals.findIndex(n => n.name === proj.signals.visual);\n        addClear(vIdx, '[0, 0]');\n\n        if (vIdx === -1) {\n          const dIdx = signals.findIndex(n => n.name === proj.signals.data);\n          addClear(dIdx, 'null');\n        }\n      });\n    } else {\n      let tIdx = signals.findIndex(n => n.name === selCmpt.name + TUPLE);\n      addClear(tIdx, 'null');\n\n      if (toggle.has(selCmpt)) {\n        tIdx = signals.findIndex(n => n.name === selCmpt.name + TOGGLE);\n        addClear(tIdx, 'false');\n      }\n    }\n\n    return signals;\n  }\n};\nexport default clear;","map":null,"metadata":{},"sourceType":"module"}