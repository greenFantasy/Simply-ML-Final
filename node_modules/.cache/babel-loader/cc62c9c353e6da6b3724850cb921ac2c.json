{"ast":null,"code":"var _jsxFileName = \"/Users/rajatmittal/Documents/SimplyML/Simply-ML/panels/src/components/building/Building.js\";\nimport React, { Component } from 'react';\n\nfunction pathRoundedRect(ctx, x, y, width, height, radius) {\n  ctx.beginPath();\n  ctx.moveTo(x, y + radius);\n  ctx.lineTo(x, y + height - radius);\n  ctx.arcTo(x, y + height, x + radius, y + height, radius);\n  ctx.lineTo(x + width - radius, y + height);\n  ctx.arcTo(x + width, y + height, x + width, y + height - radius, radius);\n  ctx.lineTo(x + width, y + radius);\n  ctx.arcTo(x + width, y, x + width - radius, y, radius);\n  ctx.lineTo(x + radius, y);\n  ctx.arcTo(x, y, x, y + radius, radius);\n}\n\nfunction getContext(id) {\n  const canvas = document.getElementById(id);\n  let context = null;\n\n  if (canvas.getContext) {\n    context = canvas.getContext(\"2d\");\n  }\n\n  return context;\n}\n\nclass Vec2 {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n}\n\nclass BBox {\n  // (x,y) is the normalized coordinate of the top-left corner,\n  // while w and h are the normalized width and height, respectively\n  constructor(x, y, w, h) {\n    this.x = x;\n    this.y = y;\n    this.w = w;\n    this.h = h;\n  }\n\n  contains(p) {\n    return p.x >= this.x && p.x <= this.x + this.w && p.y >= this.y && p.y <= this.y + this.h;\n  }\n\n}\n\nclass Layer {\n  constructor(name, n_nodes, fill) {\n    this.name = name;\n    this.n_nodes = n_nodes;\n\n    if (fill) {\n      this.bbox = new BBox(0, 0, 1, 1);\n    } else {\n      this.bbox = new BBox(0.2, 0.5, 0.4, 0.05);\n    }\n\n    this.fillStyle = \"#99F\";\n    this.strokeStyle = \"#111\";\n    this.lineWidth = 1;\n    this.edit = false;\n  }\n\n  setHover() {\n    this.lineWidth = 2;\n  }\n\n  clearHover() {\n    this.lineWidth = 1;\n  }\n\n  drawCurveTo(layer, ctx) {\n    ctx.strokeStyle = \"black\";\n    ctx.lineWidth = 1;\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n    let begin = new Vec2(layer.bbox.x + layer.bbox.w / 2, layer.bbox.y + layer.bbox.h / 2);\n    let end = new Vec2(this.bbox.x + this.bbox.w / 2, this.bbox.y + this.bbox.h / 2);\n    let cp1 = new Vec2(begin.x + layer.bbox.w / 3, begin.y);\n    let cp2 = new Vec2(end.x - this.bbox.w / 3, end.y);\n    ctx.beginPath();\n    ctx.moveTo(w * begin.x, h * begin.y);\n    ctx.bezierCurveTo(w * cp1.x, h * cp1.y, w * cp2.x, h * cp2.y, w * end.x, h * end.y);\n    ctx.stroke();\n  }\n\n  drawBackground(ctx) {\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n    pathRoundedRect(ctx, this.bbox.x * w, this.bbox.y * h, this.bbox.w * w, this.bbox.h * h, 10);\n  }\n\n  drawEdit(ctx) {\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n    ctx.lineWidth = \"1px\";\n    let p = 0.02;\n    ctx.strokeRect(w * (this.bbox.x - p), h * (this.bbox.y - p), w * (this.bbox.w + 2 * p), h * (this.bbox.h + 2 * p));\n  }\n\n  draw(ctx) {\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n    ctx.fillStyle = this.fillStyle;\n    ctx.strokeStyle = this.strokeStyle;\n    ctx.lineWidth = this.lineWidth;\n\n    if (this.edit) {\n      this.drawEdit(ctx);\n    }\n\n    this.drawBackground(ctx);\n    ctx.fill();\n    ctx.stroke();\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.font = \"16px sans-serif\";\n    ctx.fillStyle = \"black\";\n    ctx.fillText(this.name, w * (this.bbox.x + this.bbox.w / 2), h * (this.bbox.y + this.bbox.h / 2));\n  }\n\n}\n\nclass InputLayer extends Layer {\n  constructor(name, n_nodes, fill) {\n    super(name, n_nodes, fill);\n    this.fillStyle = \"#9F9\";\n    this.bbox = new BBox(0.45, 0.1, 0.1, 0.1);\n  }\n\n  drawBackground(ctx) {\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n    ctx.beginPath();\n    ctx.arc((this.bbox.x + this.bbox.w / 2) * w, (this.bbox.y + this.bbox.h / 2) * h, w * this.bbox.w / 2, 0, 2 * Math.PI);\n    ctx.closePath();\n  }\n\n}\n\nclass OutputLayer extends InputLayer {\n  constructor(name, n_nodes, fill) {\n    super(name, n_nodes, fill);\n    this.fillStyle = \"#F99\";\n    this.bbox = new BBox(0.45, 0.8, 0.1, 0.1);\n  }\n\n}\n\nclass Model {\n  constructor(name, context) {\n    this.layers = [];\n    this.name = name;\n    this.context = context;\n    this.hover = -1;\n    this.grabbed = false;\n    this.grab_offset = new Vec2(0, 0);\n    this.editing = -1;\n    this.layers.push(new InputLayer(\"Input\", 1, false));\n    this.layers.push(new OutputLayer(\"Output\", 1, false));\n  }\n\n  appendLayer(name, n_nodes) {\n    for (var l in this.layers) {\n      if (this.layers[l].name === name) {\n        let words = this.layers[l].name.split(\" \");\n        let num = parseInt(words[words.length - 1]);\n\n        if (isNaN(num)) {\n          name += \" 1\";\n        } else {\n          name = words.slice(0, -1).join(\" \") + \" \" + (num + 1);\n        }\n      }\n    }\n\n    let layer = new Layer(name, n_nodes, false);\n    this.layers.splice(-1, 0, layer);\n    this.edit(this.layers.length - 2);\n    return layer;\n  }\n\n  draw() {\n    if (!this.context) {\n      return;\n    }\n\n    this.context.clearRect(0, 0, this.context.canvas.clientWidth, this.context.canvas.clientHeight);\n\n    for (var l = 0; l < this.layers.length - 1; l++) {\n      this.layers[l].drawCurveTo(this.layers[l + 1], this.context);\n    }\n\n    for (var l2 in this.layers) {\n      this.layers[l2].draw(this.context);\n    }\n  }\n\n  setHover(idx) {\n    this.hover = idx;\n    this.layers[idx].setHover();\n  }\n\n  get isHover() {\n    return this.hover !== -1;\n  }\n\n  get hoverID() {\n    return this.hover;\n  }\n\n  removeCurrLayer() {\n    if (this.hover === this.editing && this.hover !== -1 && this.hover !== 0 && this.hover !== this.layers.length - 1) {\n      this.layers.splice(this.hover, 1);\n    }\n  }\n\n  clearEdit() {\n    if (this.editing !== -1) {\n      this.layers[this.editing].edit = false;\n      this.editing = -1;\n    }\n  }\n\n  edit(idx) {\n    this.clearEdit();\n\n    if (idx !== 0 && idx !== this.layers.length - 1) {\n      this.editing = idx;\n      this.layers[idx].edit = true;\n      Edit(this.layers[idx]);\n    }\n  }\n\n  clearHover() {\n    if (this.hover !== -1) {\n      this.layers[this.hover].clearHover();\n    }\n\n    this.hover = -1;\n  }\n\n  grab(p) {\n    if (this.hover !== -1) {\n      this.grabbed = true;\n      this.grab_offset.x = p.x - this.layers[this.hover].bbox.x;\n      this.grab_offset.y = p.y - this.layers[this.hover].bbox.y;\n      this.edit(this.hover);\n    }\n  }\n\n  move(p) {\n    if (this.hover !== -1) {\n      this.layers[this.hover].bbox.x = p.x - this.grab_offset.x;\n      this.layers[this.hover].bbox.y = p.y - this.grab_offset.y;\n    }\n  }\n\n  get isGrab() {\n    return this.grabbed;\n  }\n\n  release() {\n    this.grabbed = false;\n  }\n\n}\n\nfunction getNormMouse(elem, e) {\n  let rect = elem.getBoundingClientRect();\n  let p = new Vec2((e.clientX - rect.left) / elem.clientWidth, (e.clientY - rect.top) / elem.clientHeight);\n  return p;\n}\n\nfunction canvasMouseMove(e) {\n  let p = getNormMouse(this, e);\n\n  if (curr_model.isGrab) {\n    console.log(\"grab move\");\n    curr_model.move(p);\n    curr_model.draw();\n    return;\n  }\n\n  curr_model.clearHover();\n  let hover = false;\n\n  for (var l in curr_model.layers) {\n    if (curr_model.layers[l].bbox.contains(p)) {\n      curr_model.setHover(l);\n      hover = true;\n      break;\n    }\n  }\n\n  if (hover) {\n    this.style.cursor = \"pointer\";\n  } else {\n    this.style.cursor = \"default\";\n  }\n\n  curr_model.draw();\n}\n\nfunction canvasMouseDown(e) {\n  let p = getNormMouse(this, e);\n\n  if (curr_model.isHover) {\n    console.log(\"grab\");\n    curr_model.grab(p);\n  }\n\n  if (!curr_model.isHover || curr_model.hoverID === 0 || curr_model.hoverID === curr_model.layers.length - 1) {\n    document.getElementById(\"edit-tab\").style.display = \"none\";\n    curr_model.clearEdit();\n  }\n\n  curr_model.draw();\n}\n\nfunction canvasMouseUp(e) {\n  curr_model.release();\n  curr_model.draw();\n}\n\nfunction canvasMouseOut(e) {\n  curr_model.release();\n  curr_model.clearHover();\n  curr_model.draw();\n}\n\nvar curr_model;\n\nfunction Begin(model_in) {\n  let context = getContext(\"canvas\");\n  let layers = document.getElementById(\"horizontal-list\").children;\n\n  for (var l = 0; l < layers.length; l++) {\n    let context_layer = getContext(layers[l].children[0].id);\n    new Layer(layers[l].dataset.name, 0, true).draw(context_layer);\n  }\n\n  if (context) {\n    context.canvas.onmousemove = canvasMouseMove;\n    context.canvas.onmousedown = canvasMouseDown;\n    context.canvas.onmouseup = canvasMouseUp;\n    context.canvas.onmouseout = canvasMouseOut;\n  }\n\n  var model = model_in;\n\n  if (!model) {\n    model = new Model(\"Model1\", context); //model.appendLayer(\"Layer2\", 10);\n  }\n\n  curr_model = model;\n  curr_model.context = context;\n  model.draw(); //onResize();\n  //window.onresize = onResize;\n\n  document.getElementById(\"epochs\").oninput = function () {\n    let v = parseInt(this.value);\n    let invalid = document.getElementById(\"invalid_epochs\");\n\n    if (isNaN(v) || v < 1) {\n      invalid.style.display = \"block\";\n    } else {\n      invalid.style.display = \"none\";\n    }\n  };\n\n  document.getElementById(\"test\").disabled = true;\n  document.onkeydown = canvasKeyPress;\n}\n\nfunction dragLayer(e) {\n  e.dataTransfer.setData(\"name\", e.target.dataset.name);\n  e.dataTransfer.setData(\"activation\", e.target.dataset.activation);\n}\n\nfunction canvasAllowDrop(e) {\n  e.preventDefault();\n}\n\nfunction canvasDrop(e) {\n  e.preventDefault();\n  let p = getNormMouse(curr_model.context.canvas, e);\n  let name = e.dataTransfer.getData(\"name\");\n  let layer = curr_model.appendLayer(name + \" 1\", 10);\n  layer.activation = e.dataTransfer.getData(\"activation\");\n  layer.bbox.x = p.x - layer.bbox.w / 2;\n  layer.bbox.y = p.y - layer.bbox.h / 2;\n}\n/*\nfunction onResize() {\n  let canvas = document.getElementById(\"canvas\");\n  let canvas_wrap = document.getElementById(\"canvas-wrap\");\n\n  canvas.width = canvas_wrap.offsetWidth;\n  curr_model.draw();\n}*/\n\n\nfunction Edit(layer) {\n  document.getElementById(\"edit-tab\").style.display = \"block\";\n  let num_nodes = document.getElementById(\"num_nodes\");\n  let invalid_value = document.getElementById(\"invalid_nnodes\");\n  let title = document.getElementById(\"edit-title\");\n  title.value = layer.name;\n  num_nodes.value = layer.n_nodes;\n\n  num_nodes.oninput = function () {\n    let val = parseInt(this.value);\n\n    if (isNaN(val) || val <= 0) {\n      invalid_value.style.display = \"block\";\n    } else {\n      invalid_value.style.display = \"none\";\n    }\n\n    layer.n_nodes = parseInt(this.value);\n  };\n\n  title.oninput = function () {\n    let n = this.value;\n    title.innerHTML = n;\n    layer.name = n;\n    curr_model.draw();\n  };\n}\n\nfunction canvasKeyPress(e) {\n  if (e.keyCode === 46 || e.keyCode === 8) {\n    curr_model.removeCurrLayer();\n  }\n}\n\nclass Building extends Component {\n  componentDidMount() {\n    Begin(this.props.getModel());\n    this.props.setModel(curr_model);\n    setInterval(function () {\n      var container = document.getElementById(\"container\");\n      var visor = document.getElementById(\"tfjs-visor-container\");\n\n      if (visor && visor.children[0].dataset.isopen) {\n        container.style.justifyContent = \"left\";\n      } else {\n        container.style.justifyContent = \"center\";\n      }\n    }, 500);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 462\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      id: \"showvisor\",\n      onClick: this.props.showVisor,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 463\n      },\n      __self: this\n    }, \"Show Graphs\"), React.createElement(\"div\", {\n      id: \"menu-outer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 464\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      className: \"layers-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 465\n      },\n      __self: this\n    }, \"Layers\"), React.createElement(\"div\", {\n      className: \"table\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 466\n      },\n      __self: this\n    }, React.createElement(\"ul\", {\n      id: \"horizontal-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 467\n      },\n      __self: this\n    }, React.createElement(\"li\", {\n      draggable: \"true\",\n      onDragStart: dragLayer,\n      \"data-name\": \"Sigmoid\",\n      \"data-activation\": \"sigmoid\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 468\n      },\n      __self: this\n    }, React.createElement(\"canvas\", {\n      id: \"sigmoid_canvas\",\n      width: \"150\",\n      height: \"30\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469\n      },\n      __self: this\n    })), React.createElement(\"li\", {\n      draggable: \"true\",\n      onDragStart: dragLayer,\n      \"data-name\": \"ReLu\",\n      \"data-activation\": \"relu\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 471\n      },\n      __self: this\n    }, React.createElement(\"canvas\", {\n      id: \"relu_canvas\",\n      width: \"150\",\n      height: \"30\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472\n      },\n      __self: this\n    })), React.createElement(\"li\", {\n      draggable: \"true\",\n      onDragStart: dragLayer,\n      \"data-name\": \"Tanh\",\n      \"data-activation\": \"tanh\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 474\n      },\n      __self: this\n    }, React.createElement(\"canvas\", {\n      id: \"tanh_canvas\",\n      width: \"150\",\n      height: \"30\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 475\n      },\n      __self: this\n    })), React.createElement(\"li\", {\n      draggable: \"true\",\n      onDragStart: dragLayer,\n      \"data-name\": \"Softsign\",\n      \"data-activation\": \"softsign\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 477\n      },\n      __self: this\n    }, React.createElement(\"canvas\", {\n      id: \"softsign_canvas\",\n      width: \"150\",\n      height: \"30\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 478\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      className: \"left-break\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 482\n      },\n      __self: this\n    }), React.createElement(\"b\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 483\n      },\n      __self: this\n    }, \"Upload Data\"), React.createElement(\"input\", {\n      className: \"file-input\",\n      type: \"file\",\n      id: \"train_f\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 484\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"left-break\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 485\n      },\n      __self: this\n    }), React.createElement(\"b\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 486\n      },\n      __self: this\n    }, \"Number of Epochs\"), React.createElement(\"input\", {\n      className: \"form-input\",\n      type: \"text\",\n      id: \"epochs\",\n      defaultValue: \"32\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 487\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"invalid_epochs\",\n      style: {\n        display: \"none\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 488\n      },\n      __self: this\n    }, \"Please enter an integer greater than 0\"), React.createElement(\"button\", {\n      id: \"train\",\n      onClick: this.props.train,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 489\n      },\n      __self: this\n    }, \"TRAIN\"), React.createElement(\"div\", {\n      className: \"left-break\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 490\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      id: \"test\",\n      onClick: this.props.test,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 491\n      },\n      __self: this\n    }, \"TEST\"), React.createElement(\"ol\", {\n      id: \"error-table\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      id: \"canvas-wrap\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 494\n      },\n      __self: this\n    }, React.createElement(\"canvas\", {\n      id: \"canvas\",\n      width: \"800\",\n      height: \"800\",\n      onDrop: canvasDrop,\n      onDragOver: canvasAllowDrop,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 495\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"no-canvas\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 496\n      },\n      __self: this\n    }, \"Whoops! It looks like canvas isn't supported. Please upgrade to a newer browser.\")), React.createElement(\"div\", {\n      id: \"edit-tab\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 498\n      },\n      __self: this\n    }, React.createElement(\"b\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 499\n      },\n      __self: this\n    }, \"Name\"), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 499\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"text\",\n      id: \"edit-title\",\n      style: {\n        width: \"auto\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 500\n      },\n      __self: this\n    }), React.createElement(\"b\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 501\n      },\n      __self: this\n    }, \"Number of Nodes\"), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 501\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"text\",\n      name: \"num_nodes\",\n      id: \"num_nodes\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 502\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"invalid_nnodes\",\n      style: {\n        display: \"none\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 503\n      },\n      __self: this\n    }, \"Please enter an integer greater than 0\"))));\n  }\n\n}\n\nexport default Building;","map":{"version":3,"sources":["/Users/rajatmittal/Documents/SimplyML/Simply-ML/panels/src/components/building/Building.js"],"names":["React","Component","pathRoundedRect","ctx","x","y","width","height","radius","beginPath","moveTo","lineTo","arcTo","getContext","id","canvas","document","getElementById","context","Vec2","constructor","BBox","w","h","contains","p","Layer","name","n_nodes","fill","bbox","fillStyle","strokeStyle","lineWidth","edit","setHover","clearHover","drawCurveTo","layer","clientWidth","clientHeight","begin","end","cp1","cp2","bezierCurveTo","stroke","drawBackground","drawEdit","strokeRect","draw","textAlign","textBaseline","font","fillText","InputLayer","arc","Math","PI","closePath","OutputLayer","Model","layers","hover","grabbed","grab_offset","editing","push","appendLayer","l","words","split","num","parseInt","length","isNaN","slice","join","splice","clearRect","l2","idx","isHover","hoverID","removeCurrLayer","clearEdit","Edit","grab","move","isGrab","release","getNormMouse","elem","e","rect","getBoundingClientRect","clientX","left","clientY","top","canvasMouseMove","curr_model","console","log","style","cursor","canvasMouseDown","display","canvasMouseUp","canvasMouseOut","Begin","model_in","children","context_layer","dataset","onmousemove","onmousedown","onmouseup","onmouseout","model","oninput","v","value","invalid","disabled","onkeydown","canvasKeyPress","dragLayer","dataTransfer","setData","target","activation","canvasAllowDrop","preventDefault","canvasDrop","getData","num_nodes","invalid_value","title","val","n","innerHTML","keyCode","Building","componentDidMount","props","getModel","setModel","setInterval","container","visor","isopen","justifyContent","render","showVisor","train","test"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\n\nfunction pathRoundedRect(ctx, x, y, width, height, radius) {\n  ctx.beginPath();\n  ctx.moveTo(x, y + radius);\n  ctx.lineTo(x, y + height - radius);\n  ctx.arcTo(x, y + height, x + radius, y + height, radius);\n  ctx.lineTo(x + width - radius, y + height);\n  ctx.arcTo(x + width, y + height, x + width, y + height-radius, radius);\n  ctx.lineTo(x + width, y + radius);\n  ctx.arcTo(x + width, y, x + width - radius, y, radius);\n  ctx.lineTo(x + radius, y);\n  ctx.arcTo(x, y, x, y + radius, radius);\n}\n\nfunction getContext(id) {\n  const canvas = document.getElementById(id);\n  let context = null;\n  if(canvas.getContext) {\n    context = canvas.getContext(\"2d\");\n  }\n\n  return context;\n}\n\nclass Vec2 {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n}\n\nclass BBox {\n  // (x,y) is the normalized coordinate of the top-left corner,\n  // while w and h are the normalized width and height, respectively\n  constructor(x, y, w, h) {\n    this.x = x;\n    this.y = y;\n    this.w = w;\n    this.h = h;\n  }\n\n  contains(p) {\n    return p.x >= this.x && p.x <= (this.x+this.w) &&\n           p.y >= this.y && p.y <= (this.y+this.h);\n  }\n}\n\nclass Layer {\n  constructor(name, n_nodes, fill) {\n    this.name = name;\n    this.n_nodes = n_nodes;\n    if(fill) {\n      this.bbox = new BBox(0, 0, 1, 1);\n    } else {\n      this.bbox = new BBox(0.2, 0.5, 0.4, 0.05);\n    }\n    this.fillStyle = \"#99F\";\n    this.strokeStyle = \"#111\";\n    this.lineWidth = 1;\n    this.edit = false;\n  }\n\n  setHover() {\n    this.lineWidth = 2;\n  }\n\n  clearHover() {\n    this.lineWidth = 1;\n  }\n\n  drawCurveTo(layer, ctx) {\n    ctx.strokeStyle = \"black\";\n    ctx.lineWidth = 1;\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n    let begin = new Vec2(layer.bbox.x + layer.bbox.w/2, layer.bbox.y + layer.bbox.h/2);\n    let end = new Vec2(this.bbox.x + this.bbox.w/2, this.bbox.y + this.bbox.h/2);\n\n    let cp1 = new Vec2(begin.x + layer.bbox.w/3, begin.y);\n    let cp2 = new Vec2(end.x - this.bbox.w/3, end.y);\n\n    ctx.beginPath();\n    ctx.moveTo(w*begin.x, h*begin.y);\n    ctx.bezierCurveTo(w*cp1.x, h*cp1.y, w*cp2.x, h*cp2.y, w*end.x, h*end.y);\n    ctx.stroke();\n  }\n\n  drawBackground(ctx) {\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n\n    pathRoundedRect(ctx, this.bbox.x * w, this.bbox.y * h, this.bbox.w * w, this.bbox.h * h, 10);\n  }\n\n  drawEdit(ctx) {\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n\n    ctx.lineWidth = \"1px\";\n    let p = 0.02;\n    ctx.strokeRect(w*(this.bbox.x-p), h*(this.bbox.y-p), w*(this.bbox.w+2*p), h*(this.bbox.h+2*p));\n  }\n\n  draw(ctx) {\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n\n    ctx.fillStyle = this.fillStyle;\n    ctx.strokeStyle = this.strokeStyle;\n    ctx.lineWidth = this.lineWidth;\n\n    if(this.edit) {\n      this.drawEdit(ctx);\n    }\n\n    this.drawBackground(ctx);\n    ctx.fill();\n    ctx.stroke();\n\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.font = \"16px sans-serif\";\n    ctx.fillStyle = \"black\";\n    ctx.fillText(this.name, w*(this.bbox.x+this.bbox.w/2), h*(this.bbox.y+this.bbox.h/2));\n  }\n}\n\nclass InputLayer extends Layer {\n  constructor(name, n_nodes, fill) {\n    super(name, n_nodes, fill);\n    this.fillStyle = \"#9F9\";\n    this.bbox = new BBox(0.45, 0.1, 0.1, 0.1);\n  }\n\n  drawBackground(ctx) {\n    let w = ctx.canvas.clientWidth;\n    let h = ctx.canvas.clientHeight;\n\n    ctx.beginPath();\n    ctx.arc((this.bbox.x + this.bbox.w/2)*w, (this.bbox.y+this.bbox.h/2)*h, w*this.bbox.w/2, 0, 2*Math.PI);\n    ctx.closePath();\n  }\n}\n\nclass OutputLayer extends InputLayer {\n  constructor(name, n_nodes, fill) {\n    super(name, n_nodes, fill);\n    this.fillStyle = \"#F99\";\n    this.bbox = new BBox(0.45, 0.8, 0.1, 0.1);\n  }\n}\n\nclass Model {\n  constructor(name, context) {\n    this.layers = [];\n    this.name = name;\n    this.context = context;\n    this.hover = -1;\n    this.grabbed = false;\n    this.grab_offset = new Vec2(0,0);\n    this.editing = -1;\n    this.layers.push(new InputLayer(\"Input\", 1, false));\n    this.layers.push(new OutputLayer(\"Output\", 1, false));\n  }\n\n  appendLayer(name, n_nodes) {\n    for(var l in this.layers) {\n      if(this.layers[l].name === name) {\n        let words = this.layers[l].name.split(\" \");\n        let num = parseInt(words[words.length-1]);\n\n        if(isNaN(num)) {\n          name += \" 1\";\n        } else {\n          name = words.slice(0,-1).join(\" \") + \" \" + (num+1);\n        }\n      }\n    }\n    let layer = new Layer(name, n_nodes, false);\n    this.layers.splice(-1, 0, layer);\n    this.edit(this.layers.length - 2);\n\n    return layer;\n  }\n\n  draw() {\n    if(!this.context) {\n      return;\n    }\n\n    this.context.clearRect(0, 0, this.context.canvas.clientWidth, this.context.canvas.clientHeight);\n\n    for(var l = 0; l < this.layers.length - 1; l++) {\n      this.layers[l].drawCurveTo(this.layers[l+1], this.context);\n    }\n    for(var l2 in this.layers) {\n      this.layers[l2].draw(this.context);\n    }\n  }\n\n  setHover(idx) {\n    this.hover = idx;\n    this.layers[idx].setHover();\n  }\n\n  get isHover() {\n    return this.hover !== -1;\n  }\n\n  get hoverID() {\n    return this.hover;\n  }\n\n  removeCurrLayer() {\n    if(this.hover === this.editing && this.hover !== -1 && this.hover !== 0 && this.hover !== this.layers.length-1) {\n      this.layers.splice(this.hover, 1);\n    }\n  }\n\n  clearEdit() {\n    if(this.editing !== -1) {\n      this.layers[this.editing].edit = false;\n      this.editing = -1;\n    }\n  }\n\n  edit(idx) {\n    this.clearEdit();\n    if(idx !== 0 && idx !== this.layers.length-1) {\n      this.editing = idx;\n      this.layers[idx].edit = true;\n      Edit(this.layers[idx]);\n    }\n  }\n\n  clearHover() {\n    if(this.hover !== -1) {\n      this.layers[this.hover].clearHover();\n    }\n    this.hover = -1;\n  }\n\n  grab(p) {\n    if(this.hover !== -1) {\n      this.grabbed = true;\n      this.grab_offset.x = p.x - this.layers[this.hover].bbox.x;\n      this.grab_offset.y = p.y - this.layers[this.hover].bbox.y;\n\n      this.edit(this.hover);\n    }\n  }\n\n  move(p) {\n    if(this.hover !== -1) {\n      this.layers[this.hover].bbox.x = p.x - this.grab_offset.x;\n      this.layers[this.hover].bbox.y = p.y - this.grab_offset.y;\n    }\n  }\n\n  get isGrab() {\n    return this.grabbed;\n  }\n\n  release() {\n    this.grabbed = false;\n  }\n}\n\nfunction getNormMouse(elem, e) {\n  let rect = elem.getBoundingClientRect();\n  let p = new Vec2((e.clientX - rect.left) / elem.clientWidth,\n                   (e.clientY - rect.top) / elem.clientHeight);\n\n  return p;\n}\n\nfunction canvasMouseMove(e) {\n  let p = getNormMouse(this, e);\n\n  if(curr_model.isGrab) {\n    console.log(\"grab move\");\n    curr_model.move(p);\n    curr_model.draw();\n    return;\n  }\n\n  curr_model.clearHover();\n\n  let hover = false;\n  for(var l in curr_model.layers) {\n    if(curr_model.layers[l].bbox.contains(p)) {\n      curr_model.setHover(l);\n      hover = true;\n      break;\n    }\n  }\n\n  if(hover) {\n    this.style.cursor = \"pointer\";\n  } else {\n    this.style.cursor = \"default\";\n  }\n\n  curr_model.draw();\n}\n\nfunction canvasMouseDown(e) {\n  let p = getNormMouse(this, e);\n\n  if(curr_model.isHover) {\n    console.log(\"grab\");\n    curr_model.grab(p);\n  }\n  if(!curr_model.isHover || (curr_model.hoverID === 0 || curr_model.hoverID === curr_model.layers.length-1)) {\n    document.getElementById(\"edit-tab\").style.display = \"none\";\n    curr_model.clearEdit();\n  }\n\n  curr_model.draw();\n}\n\nfunction canvasMouseUp(e) {\n  curr_model.release();\n  curr_model.draw();\n}\n\nfunction canvasMouseOut(e) {\n  curr_model.release();\n  curr_model.clearHover();\n  curr_model.draw();\n}\n\nvar curr_model;\n\nfunction Begin(model_in) {\n  let context = getContext(\"canvas\");\n\n  let layers = document.getElementById(\"horizontal-list\").children;\n  for(var l = 0; l < layers.length; l++) {\n    let context_layer = getContext(layers[l].children[0].id);\n    (new Layer(layers[l].dataset.name, 0, true)).draw(context_layer);\n  }\n\n  if(context) {\n    context.canvas.onmousemove = canvasMouseMove;\n    context.canvas.onmousedown = canvasMouseDown;\n    context.canvas.onmouseup = canvasMouseUp;\n    context.canvas.onmouseout = canvasMouseOut;\n  }\n\n  var model = model_in;\n  if(!model) {\n    model = new Model(\"Model1\", context);\n    //model.appendLayer(\"Layer2\", 10);\n  }\n\n  curr_model = model;\n  curr_model.context = context;\n  model.draw();\n\n  //onResize();\n  //window.onresize = onResize;\n\n  document.getElementById(\"epochs\").oninput = function() {\n    let v = parseInt(this.value);\n    let invalid = document.getElementById(\"invalid_epochs\");\n    if(isNaN(v) || v < 1) {\n      invalid.style.display = \"block\";\n    } else {\n      invalid.style.display = \"none\";\n    }\n  }\n\n  document.getElementById(\"test\").disabled = true;\n\n  document.onkeydown = canvasKeyPress;\n}\n\nfunction dragLayer(e) {\n  e.dataTransfer.setData(\"name\", e.target.dataset.name);\n  e.dataTransfer.setData(\"activation\", e.target.dataset.activation);\n}\n\nfunction canvasAllowDrop(e) {\n  e.preventDefault();\n}\n\nfunction canvasDrop(e) {\n  e.preventDefault();\n\n  let p = getNormMouse(curr_model.context.canvas, e);\n\n  let name = e.dataTransfer.getData(\"name\");\n  let layer = curr_model.appendLayer(name + \" 1\", 10);\n  layer.activation = e.dataTransfer.getData(\"activation\");\n\n  layer.bbox.x = p.x - layer.bbox.w/2;\n  layer.bbox.y = p.y - layer.bbox.h/2;\n}\n/*\nfunction onResize() {\n  let canvas = document.getElementById(\"canvas\");\n  let canvas_wrap = document.getElementById(\"canvas-wrap\");\n\n  canvas.width = canvas_wrap.offsetWidth;\n  curr_model.draw();\n}*/\n\nfunction Edit(layer) {\n  document.getElementById(\"edit-tab\").style.display = \"block\";\n  let num_nodes = document.getElementById(\"num_nodes\");\n  let invalid_value = document.getElementById(\"invalid_nnodes\");\n  let title = document.getElementById(\"edit-title\");\n  title.value = layer.name;\n  num_nodes.value = layer.n_nodes;\n\n  num_nodes.oninput = function() {\n    let val = parseInt(this.value);\n    if(isNaN(val) || val <= 0) {\n      invalid_value.style.display = \"block\";\n    } else {\n      invalid_value.style.display = \"none\";\n    }\n    layer.n_nodes = parseInt(this.value);\n  }\n\n  title.oninput = function() {\n    let n = this.value;\n\n    title.innerHTML = n;\n    layer.name = n;\n    curr_model.draw();\n  }\n}\n\nfunction canvasKeyPress(e) {\n  if(e.keyCode === 46 || e.keyCode === 8) {\n    curr_model.removeCurrLayer();\n  }\n}\n\nclass Building extends Component {\n  componentDidMount() {\n    Begin(this.props.getModel());\n    this.props.setModel(curr_model);\n\n    setInterval(function() {\n      var container = document.getElementById(\"container\");\n      var visor = document.getElementById(\"tfjs-visor-container\");\n\n      if(visor && visor.children[0].dataset.isopen) {\n        container.style.justifyContent = \"left\";\n      } else {\n        container.style.justifyContent = \"center\";\n      }\n    }, 500);\n  }\n\n  render() {\n    return (\n      <div id=\"container\">\n        <button id=\"showvisor\" onClick={this.props.showVisor}>Show Graphs</button>\n        <div id=\"menu-outer\">\n          <h3 className=\"layers-title\">Layers</h3>\n          <div className=\"table\">\n            <ul id=\"horizontal-list\">\n              <li draggable=\"true\" onDragStart={dragLayer} data-name=\"Sigmoid\" data-activation=\"sigmoid\">\n                <canvas id=\"sigmoid_canvas\" width=\"150\" height=\"30\"></canvas>\n              </li>\n              <li draggable=\"true\" onDragStart={dragLayer} data-name=\"ReLu\" data-activation=\"relu\">\n                <canvas id=\"relu_canvas\" width=\"150\" height=\"30\"></canvas>\n              </li>\n              <li draggable=\"true\" onDragStart={dragLayer} data-name=\"Tanh\" data-activation=\"tanh\">\n                <canvas id=\"tanh_canvas\" width=\"150\" height=\"30\"></canvas>\n              </li>\n              <li draggable=\"true\" onDragStart={dragLayer} data-name=\"Softsign\" data-activation=\"softsign\">\n                <canvas id=\"softsign_canvas\" width=\"150\" height=\"30\"></canvas>\n              </li>\n            </ul>\n          </div>\n          <div className=\"left-break\"></div>\n          <b>Upload Data</b>\n          <input className=\"file-input\" type=\"file\" id=\"train_f\"></input>\n          <div className=\"left-break\"></div>\n          <b>Number of Epochs</b>\n          <input className=\"form-input\" type=\"text\" id=\"epochs\" defaultValue=\"32\"></input>\n          <div id=\"invalid_epochs\" style={{display: \"none\"}}>Please enter an integer greater than 0</div>\n          <button id=\"train\" onClick={this.props.train}>TRAIN</button>\n          <div className=\"left-break\"></div>\n          <button id=\"test\" onClick={this.props.test}>TEST</button>\n          <ol id=\"error-table\"></ol>\n        </div>\n        <div id=\"canvas-wrap\">\n          <canvas id=\"canvas\" width=\"800\" height=\"800\" onDrop={canvasDrop} onDragOver={canvasAllowDrop}>\n            <div className=\"no-canvas\">Whoops! It looks like canvas isn't supported. Please upgrade to a newer browser.</div>\n          </canvas>\n          <div id=\"edit-tab\">\n            <b>Name</b><br></br>\n            <input type=\"text\" id=\"edit-title\" style={{width: \"auto\"}}></input>\n            <b>Number of Nodes</b><br></br>\n            <input type=\"text\" name=\"num_nodes\" id=\"num_nodes\"></input>\n            <div id=\"invalid_nnodes\" style={{display: \"none\"}}>Please enter an integer greater than 0</div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n}\n\nexport default Building;\n"]},"metadata":{},"sourceType":"module"}