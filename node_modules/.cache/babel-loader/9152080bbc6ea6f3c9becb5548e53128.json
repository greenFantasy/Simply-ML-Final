{"ast":null,"code":"import { array8, array16, array32 } from './arrays';\n/**\n * Maintains CrossFilter state.\n */\n\nexport default function Bitmaps() {\n  var width = 8,\n      data = [],\n      seen = array32(0),\n      curr = array(0, width),\n      prev = array(0, width);\n  return {\n    data: function () {\n      return data;\n    },\n    seen: function () {\n      return seen = lengthen(seen, data.length);\n    },\n    add: function (array) {\n      for (var i = 0, j = data.length, n = array.length, t; i < n; ++i) {\n        t = array[i];\n        t._index = j++;\n        data.push(t);\n      }\n    },\n    remove: function (num, map) {\n      // map: index -> boolean (true => remove)\n      var n = data.length,\n          copy = Array(n - num),\n          reindex = data,\n          // reuse old data array for index map\n      t,\n          i,\n          j; // seek forward to first removal\n\n      for (i = 0; !map[i] && i < n; ++i) {\n        copy[i] = data[i];\n        reindex[i] = i;\n      } // condense arrays\n\n\n      for (j = i; i < n; ++i) {\n        t = data[i];\n\n        if (!map[i]) {\n          reindex[i] = j;\n          curr[j] = curr[i];\n          prev[j] = prev[i];\n          copy[j] = t;\n          t._index = j++;\n        } else {\n          reindex[i] = -1;\n        }\n\n        curr[i] = 0; // clear unused bits\n      }\n\n      data = copy;\n      return reindex;\n    },\n    size: function () {\n      return data.length;\n    },\n    curr: function () {\n      return curr;\n    },\n    prev: function () {\n      return prev;\n    },\n    reset: function (k) {\n      prev[k] = curr[k];\n    },\n    all: function () {\n      return width < 0x101 ? 0xff : width < 0x10001 ? 0xffff : 0xffffffff;\n    },\n    set: function (k, one) {\n      curr[k] |= one;\n    },\n    clear: function (k, one) {\n      curr[k] &= ~one;\n    },\n    resize: function (n, m) {\n      var k = curr.length;\n\n      if (n > k || m > width) {\n        width = Math.max(m, width);\n        curr = array(n, width, curr);\n        prev = array(n, width);\n      }\n    }\n  };\n}\n\nfunction lengthen(array, length, copy) {\n  if (array.length >= length) return array;\n  copy = copy || new array.constructor(length);\n  copy.set(array);\n  return copy;\n}\n\nfunction array(n, m, array) {\n  var copy = (m < 0x101 ? array8 : m < 0x10001 ? array16 : array32)(n);\n  if (array) copy.set(array);\n  return copy;\n}","map":null,"metadata":{},"sourceType":"module"}