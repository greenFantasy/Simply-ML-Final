{"ast":null,"code":"import { isObject } from 'vega-util';\nimport { getAllCompositeMarks } from './compositemark';\nimport { VL_ONLY_GUIDE_CONFIG, VL_ONLY_LEGEND_CONFIG } from './guide';\nimport { defaultLegendConfig } from './legend';\nimport * as mark from './mark';\nimport { PRIMITIVE_MARKS, VL_ONLY_MARK_CONFIG_PROPERTIES, VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX } from './mark';\nimport { defaultScaleConfig } from './scale';\nimport { defaultConfig as defaultSelectionConfig } from './selection';\nimport { DEFAULT_SPACING, isStep } from './spec/base';\nimport { extractTitleConfig } from './title';\nimport { duplicate, getFirstDefined, keys, mergeDeep } from './util';\nexport function getViewConfigContinuousSize(viewConfig, channel) {\n  return viewConfig[channel === 'width' ? 'continuousWidth' : 'continuousHeight'];\n}\nexport function getViewConfigDiscreteStep(viewConfig, channel) {\n  const size = getViewConfigDiscreteSize(viewConfig, channel);\n  return isStep(size) ? size.step : DEFAULT_STEP;\n}\nexport function getViewConfigDiscreteSize(viewConfig, channel) {\n  const size = viewConfig[channel === 'width' ? 'discreteWidth' : 'discreteHeight'];\n  return getFirstDefined(size, {\n    step: viewConfig.step\n  });\n}\nexport const DEFAULT_STEP = 20;\nexport const defaultViewConfig = {\n  continuousWidth: 200,\n  continuousHeight: 200,\n  step: DEFAULT_STEP\n};\nexport function isVgScheme(rangeConfig) {\n  return rangeConfig && !!rangeConfig['scheme'];\n}\nexport const defaultConfig = {\n  background: 'white',\n  padding: 5,\n  timeFormat: '%b %d, %Y',\n  countTitle: 'Count of Records',\n  view: defaultViewConfig,\n  mark: mark.defaultMarkConfig,\n  area: {},\n  bar: mark.defaultBarConfig,\n  circle: {},\n  geoshape: {},\n  image: {},\n  line: {},\n  point: {},\n  rect: mark.defaultRectConfig,\n  rule: {\n    color: 'black'\n  },\n  square: {},\n  text: {\n    color: 'black'\n  },\n  tick: mark.defaultTickConfig,\n  trail: {},\n  boxplot: {\n    size: 14,\n    extent: 1.5,\n    box: {},\n    median: {\n      color: 'white'\n    },\n    outliers: {},\n    rule: {},\n    ticks: null\n  },\n  errorbar: {\n    center: 'mean',\n    rule: true,\n    ticks: false\n  },\n  errorband: {\n    band: {\n      opacity: 0.3\n    },\n    borders: false\n  },\n  scale: defaultScaleConfig,\n  projection: {},\n  axis: {},\n  axisX: {},\n  axisY: {},\n  axisLeft: {},\n  axisRight: {},\n  axisTop: {},\n  axisBottom: {},\n  axisBand: {},\n  legend: defaultLegendConfig,\n  header: {\n    titlePadding: 10,\n    labelPadding: 10\n  },\n  headerColumn: {},\n  headerRow: {},\n  headerFacet: {},\n  selection: defaultSelectionConfig,\n  style: {},\n  title: {},\n  facet: {\n    spacing: DEFAULT_SPACING\n  },\n  repeat: {\n    spacing: DEFAULT_SPACING\n  },\n  concat: {\n    spacing: DEFAULT_SPACING\n  }\n};\nexport function initConfig(config) {\n  return mergeDeep(duplicate(defaultConfig), config);\n}\nconst MARK_STYLES = ['view', ...PRIMITIVE_MARKS];\nconst VL_ONLY_CONFIG_PROPERTIES = ['padding', 'facet', 'concat', 'repeat', 'numberFormat', 'timeFormat', 'countTitle', 'header', 'scale', 'selection', 'overlay' // FIXME: Redesign and unhide this\n];\nconst VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX = Object.assign({\n  view: ['continuousWidth', 'continuousHeight', 'discreteWidth', 'discreteHeight', 'step']\n}, VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);\nexport function stripAndRedirectConfig(config) {\n  config = duplicate(config);\n\n  for (const prop of VL_ONLY_CONFIG_PROPERTIES) {\n    delete config[prop];\n  } // Remove Vega-Lite only axis/legend config\n\n\n  if (config.axis) {\n    for (const prop of VL_ONLY_GUIDE_CONFIG) {\n      delete config.axis[prop];\n    }\n  }\n\n  if (config.legend) {\n    for (const prop of VL_ONLY_GUIDE_CONFIG) {\n      delete config.legend[prop];\n    }\n\n    for (const prop of VL_ONLY_LEGEND_CONFIG) {\n      delete config.legend[prop];\n    }\n  } // Remove Vega-Lite only generic mark config\n\n\n  if (config.mark) {\n    for (const prop of VL_ONLY_MARK_CONFIG_PROPERTIES) {\n      delete config.mark[prop];\n    }\n  }\n\n  for (const markType of MARK_STYLES) {\n    // Remove Vega-Lite-only mark config\n    for (const prop of VL_ONLY_MARK_CONFIG_PROPERTIES) {\n      delete config[markType][prop];\n    } // Remove Vega-Lite only mark-specific config\n\n\n    const vlOnlyMarkSpecificConfigs = VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX[markType];\n\n    if (vlOnlyMarkSpecificConfigs) {\n      for (const prop of vlOnlyMarkSpecificConfigs) {\n        delete config[markType][prop];\n      }\n    } // Redirect mark config to config.style so that mark config only affect its own mark type\n    // without affecting other marks that share the same underlying Vega marks.\n    // For example, config.rect should not affect bar marks.\n\n\n    redirectConfig(config, markType);\n  }\n\n  for (const m of getAllCompositeMarks()) {\n    // Clean up the composite mark config as we don't need them in the output specs anymore\n    delete config[m];\n  } // Redirect config.title -- so that title config do not\n  // affect header labels, which also uses `title` directive to implement.\n\n\n  redirectConfig(config, 'title', 'group-title'); // Remove empty config objects\n\n  for (const prop in config) {\n    if (isObject(config[prop]) && keys(config[prop]).length === 0) {\n      delete config[prop];\n    }\n  }\n\n  return keys(config).length > 0 ? config : undefined;\n}\n\nfunction redirectConfig(config, prop, // string = composite mark\ntoProp, compositeMarkPart) {\n  const propConfig = prop === 'title' ? extractTitleConfig(config.title).mark : compositeMarkPart ? config[prop][compositeMarkPart] : config[prop];\n\n  if (prop === 'view') {\n    toProp = 'cell'; // View's default style is \"cell\"\n  }\n\n  const style = Object.assign(Object.assign({}, propConfig), config.style[prop]); // set config.style if it is not an empty object\n\n  if (keys(style).length > 0) {\n    config.style[toProp || prop] = style;\n  }\n\n  if (!compositeMarkPart) {\n    // For composite mark, so don't delete the whole config yet as we have to do multiple redirections.\n    delete config[prop];\n  }\n}","map":null,"metadata":{},"sourceType":"module"}